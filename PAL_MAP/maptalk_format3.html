<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>formats demo</title>
    <script src="https://unpkg.com/maptalks/dist/maptalks.min.js"></script>
    <script src="maptalks_formats/dist/maptalks.formats.js"></script>
    <script type="text/javascript" src="echarts.simple.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/maptalks/dist/maptalks.css">
    <style type="text/css">
        html,body{
            margin:0px;
            height:100%;
            width: 100%;
         }
    </style>
</head>
<body scroll="no">
<div style="width:100%;height:80%;" id="map"></div>
<textarea style="width:100%;height:20%;" id="console"></textarea>
<script type="text/javascript" >

  var map = new maptalks.Map('map', {
        center: [31.5033, 34.4623],
        zoom: 16,
        pitch: 70,
      //bearing: 180,
        centerCross: true,
        baseLayer: new maptalks.TileLayer('base', {
          urlTemplate: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',
          subdomains: ["a","b","c","d"],
          attribution: '&copy; <a href="http://osm.org">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/">CARTO</a>'
        })
      });

    new maptalks.control.Toolbar({
      'vertical' : false,
      'position' : 'top-left',
      'items'     : [
        {
            item: '2016',
            click : function () {
                    // 01
    var chartDom = document.createElement('div');
    chartDom.style.cssText = 'width:650px; height:300px;';
    createChart(chartDom);
    var echartsUI = new maptalks.ui.UIMarker([31.5033, 34.4623], {
        'draggable'     : false,        'content'       : chartDom      }).addTo(map).show();
      // ECharts's chart creation
      function createChart(dom) {
        var myChart = echarts.init(dom);
        var option = {  title : { x:'center' },  tooltip : {  trigger: 'item',  formatter: '{a} <br/>{b} : {c} ({d}%)'   },
        legend: {  x : 'center',  y : 'bottom', data:['DeiralBalah', 'GazaCity', 'KhanYunis', 'NorthGaza', 'Rafah', 'Jerusalem', 'Bethlehem', 'Hebron', '-Jenin', 'Jericho', 'Nablus', 'Qalqilya', 'Ramallah', 'Salfit', 'Tubas', 'Tulkarm'] },
        toolbox: { show : true, feature : {  mark : { show: true }, dataView : { show: true, readOnly: false }, magicType : {  show: true,  type: ['pie', 'funnel']  },
        restore : { show: true },  saveAsImage : { show: true } } },  calculable : true,
          series : [
            { name:'Area mode',  type:'pie',  radius : [10, 60],
              center : ['50%', '50%'],
              roseType : 'area',
              data:[
                { value:10, name:'DeiralBalah' },
                { value:5, name:'GazaCity' },
                { value:15, name:'KhanYunis' },
                { value:25, name:'NorthGaza' },
                { value:20, name:'Rafah' },
                { value:35, name:'Jerusalem' },
                { value:30, name:'Bethlehem' },
                { value:40, name:'Hebron' },
                { value:10, name:'Jenin' },
                { value:5, name:'Jericho' },
                { value:15, name:'Nablus' },
                { value:25, name:'Qalqilya' },
                { value:20, name:'Ramallah' },
                { value:35, name:'Salfit' },
                { value:30, name:'Tubas' },
                { value:40, name:'Tulkarm' } ]  } ] };
        myChart.setOption(option); }
        map.fitExtent(layer.getExtent());  });            }
        }, 
       /////////////////////////////          //////////////////////////////
        {
            item: 'GeoJSON',
            click : function () {
                maptalks.Formats.geojson('hospital.geojson', function (err, geojson) {
                    if (err) {
                        throw err;
                    }
                    map.removeLayer('geojson');
                    var layer = new maptalks.VectorLayer('geojson', geojson).addTo(map);
                    map.fitExtent(layer.getExtent());
                });
            }
        },
        {
            item: 'GPX',
            click : function () {
                maptalks.Formats.gpx('maptalks_formats/test/a.gpx', function (err, geojson) {
                    if (err) {
                        throw err;
                    }
                    map.removeLayer('gpx');
                    var layer = new maptalks.VectorLayer('gpx', geojson).addTo(map);

                    var point = new maptalks.Marker([31.4218, 34.3854]);
      layer.addGeometry(point);
      point.setInfoWindow({
        title: 'hello maptalks',
        content: '<div class="info-content"><video controls width="80" height="60" src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"></video></div>'
      });
      point.openInfoWindow();
                    
                    map.fitExtent(layer.getExtent());
                });
            }
        },
        {
            item: 'KML',
            click : function () {
                maptalks.Formats.kml('COORDpalestine_hrp_political_violence_events_and_fatalities_by_month-year_as-of-18oct2023.csv.kml', function (err, geojson) {
                    if (err) {
                        throw err;
                    }
                    map.removeLayer('kml');
                    var layer = new maptalks.VectorLayer('kml', geojson).addTo(map);
                    map.fitExtent(layer.getExtent());
                });
            }
        },
        {
            item: 'Polyline',
            click : function () {
                maptalks.Formats.polyline('maptalks_formats//test/a.polyline', function (err, geojson) {
                    if (err) {
                        throw err;
                    }
                    map.removeLayer('polyline');
                    var layer = new maptalks.VectorLayer('polyline', geojson).addTo(map);
                    map.fitExtent(layer.getExtent());
                });
            }
        },
        {
            item: 'TopoJSON',
            click : function () {
                maptalks.Formats.topojson('maptalks_formats//test/a.topojson', function (err, geojson) {
                    if (err) {
                        throw err;
                    }
                    map.removeLayer('topojson');
                    var layer = new maptalks.VectorLayer('topojson', geojson).addTo(map);
                    map.fitExtent(layer.getExtent());
                });
            }
        },
        {
            item: 'WKT',
            click : function () {
                maptalks.Formats.wkt('maptalks_formats//test/a.wkt', function (err, geojson) {
                    if (err) {
                        throw err;
                    }
                    map.removeLayer('wkt');
                    var layer = new maptalks.VectorLayer('wkt', geojson).addTo(map);

                    var options = {
        'title'     : 'Map\' InfoWindow',
        'content'   : 'Click on map to reopen'

        // 'autoPan': true,
        // 'width': 300,
        // 'minHeight': 120,
        // 'custom': false,
        //'autoOpenOn' : 'click',  //set to null if not to open window when clicking on map
        //'autoCloseOn' : 'click'
      };
      var infoWindow = new maptalks.ui.InfoWindow(options);
      infoWindow.addTo(map).show();

                    
                    map.fitExtent(layer.getExtent());
                });
            }
        },
        {
            item: 'osm',
            click : function () {
                maptalks.Formats.osm('maptalks_formats//test/osm.osm', function (err, geojson) {
                    if (err) {
                        throw err;
                    }
                    map.removeLayer('osm');
                    var layer = new maptalks.VectorLayer('osm', geojson).addTo(map);
                    map.on('click', function (e) {
        //reset colors
        layer.forEach(function (g) {
          g.updateSymbol({
            'markerFill' : '#0e595e'
          });
        });
        //identify
        map.identify(
          {
            'coordinate' : e.coordinate,
            'layers' : [layer]
          },
          function (geos) {
            if (geos.length === 0) {
              return;
            }
            geos.forEach(function (g) {
              g.updateSymbol({
                'markerFill' : '#f00'
              });
            });
          }
        );
      });
                    map.fitExtent(layer.getExtent());
                });
            }
        }
    ]
    }).addTo(map);



    

// ////////////// >>>>>> drawing
// ////////////// >>>>>> drawing
var layer = new maptalks.VectorLayer('vector').addTo(map);

      var drawTool = new maptalks.DrawTool({
        mode: 'Point'
      }).addTo(map).disable();

      drawTool.on('drawend', function (param) {
        console.log(param.geometry);
        layer.addGeometry(param.geometry);
      });

      var items = ['Point', 'LineString', 'Polygon', 'Circle', 'Ellipse', 'Rectangle', 'FreeHandLineString', 'FreeHandPolygon'].map(function (value) {
        return {
          item: value,
          click: function () {
            drawTool.setMode(value).enable();
          }
        };
      });

      var toolbar = new maptalks.control.Toolbar({
        items: [
          {
            item: 'Shape',
            children: items
          },
          {
            item: 'Disable',
            click: function () {
              drawTool.disable();
            }
          },
          {
            item: 'Clear',
            click: function () {
              layer.clear();
            }
          }
        ]
      }).addTo(map);
// ////////////// >>>>>> drawing
// ////////////// >>>>>> drawing
    
    function info(info) {
        document.getElementById('console').value = '<pre>' + info + '</pre>';
    }
</script>
</body>
</html>
